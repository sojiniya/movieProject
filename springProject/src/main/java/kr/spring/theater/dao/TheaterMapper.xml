<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.theater.dao.TheaterMapper"> 
	<!-- 1. 목록 명시 : 극장 리스트 -->
	<!-- 어노테이션을 이용할 경우 id는 MemberMapper.java에서 명시한 "인터페이스 메서드명"이 됨(동일한 메서드명id사용 필수) -->
	<select id="selectList" parameterType="map" resultType="theaterVO">
		SELECT * FROM 
		(SELECT a.*, rownum rnum FROM 
			(SELECT th.theater_num,
					b.hit,
					b.reg_date,
					m.id 
					FROM spboard b JOIN spmember m ON b.mem_num=m.mem_num
					<where>
						<if test="keyword != '' and keyfield == 1"><!-- 제목으로 검색 -->
							b.title LIKE '%' || #{keyword} || '%'
						</if>
						<if test="keyword != '' and keyfield == 2"><!-- id 검색-->
							m.id LIKE '%' || #{keyword} || '%'
						</if>
						<if test="keyword != '' and keyfield == 3"><!-- 내용 검색 -->
							b.content LIKE '%' || #{keyword} || '%'
						</if>
						<if test="keyword != '' and keyfield == 4"><!-- 제목+내용 검색 -->
							b.title LIKE '%' || #{keyword} || '%' or
							b.content LIKE '%' || #{keyword} || '%'
						</if>
					</where>
			 ORDER BY b.board_num DESC)a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	<!-- 1-1. 글 목록 : 총 레코드 수 -->
	<select id="selectRowCount" parameterType="map" resultType="integer">
		SELECT COUNT(*) FROM spboard b JOIN spmember m ON b.mem_num = m.mem_num
		<where>
			<if test="keyword != '' and keyfield == 1"><!-- 제목으로 검색 -->
				b.title LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 2"><!-- id 검색 -->
				m.id LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 3"><!-- 내용 검색 -->
				b.content LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 4"><!-- 제목+내용 검색 -->
				b.title LIKE '%' || #{keyword} || '%' or
				b.content LIKE '%' || #{keyword} || '%'
			</if>
		</where>
	</select>
</mapper>







